{% extends "base.html" %}
{% load contacted %}

{% block js %}
{{ block.super }}
<script type="text/javascript">
$(function(){
  var hash = window.location.hash;
  hash && $('ul.nav a[href="' + hash + '"]').tab('show');

  $('.nav-tabs a').click(function (e) {
    $(this).tab('show');
    window.location.hash = this.hash;
  });
});
</script>
{% endblock %}

{% block content %}

{% if user == object.user %}

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
        Votre compte : {{ object }}
    </h3>
</div>
<div class="panel-body">
    Téléphone : {{object.phone }}
    <br>
    <a class="btn btn-default" href="{% url 'user_account_update' object.user.username %}">
        Modifier vos informations personnelles
    </a>
    <a class="btn btn-default" href="{% url 'password_change' %}">
        Changer de mot de passe
    </a>
</div>
</div>

{% else %}

<h2>Profil de {{ object }}</h2>

{% endif %}

{% if user == object.user %}

<div role="tabpanel">

  <!-- Nav tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active">
        <a href="#sale" aria-controls="home" role="tab" data-toggle="tab">
            A vendre
        </a>
    </li>
    <li role="presentation">
        <a href="#rent" aria-controls="rent" role="tab" data-toggle="tab">
            A louer
        </a>
    </li>
    <li role="presentation">
        <a href="#sale_search" aria-controls="sale_search" role="tab" data-toggle="tab">
            Recherche achat
        </a>
    </li>
    <li role="presentation">
        <a href="#rent_search" aria-controls="rent_search" role="tab" data-toggle="tab">
            Recherche location
        </a>
    </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="sale">
        <br>
        {% if sales %}

        {% for ad in sales %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="{% url 'sale:ads_ad_detail' ad.slug %}">
                    {{ ad }}
                </a>
            </div>
            <div class="panel-body">
                <a class="btn btn-default" href="{% url 'sale:ads_ad_update' ad.slug %}">
                    Modifier
                </a>
                <a class="btn btn-default" href="{% url 'sale:ads_ad_delete' ad.slug %}">
                    Supprimer
                </a>
            </div>
            <table class="table">
                {% for asr in ad.adsearchrelation_set.all %}
                {% if asr.valid %}
                <tr>
                    <td>
                        <a href="{% url 'sale:ads_search_detail' asr.search.slug %}">
                            {{ asr.search }}
                        </a>
                    </td>
                    <td>
                        {% if asr.search_contacted %}
                        Vous avez déjà contacté l'acheteur
                        {% endif %}
                        {% if asr.ad_contacted %}
                        Vous avez été contacté par l'acheteur
                        {% endif %}
                        <a href="{% url 'sale:ads_search_detail' asr.search.slug %}#contact">
                            Contactez l'acheteur
                        </a>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>
        {% endfor %}
        {% endif %}
        <div>
            <a class="btn btn-default btn-primary" href="{% url 'sale:ads_ad_add' %}">
                Ajouter une annonce de bien à vendre
            </a>
        </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="rent">
        <br>
        {% if rentals %}

        {% for ad in rentals %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="{% url 'rent:ads_ad_detail' ad.slug %}">
                    {{ ad }}
                </a>
            </div>
            <div class="panel-body">
                <a class="btn btn-default" href="{% url 'rent:ads_ad_update' ad.slug %}">
                    Modifier
                </a>
                <a class="btn btn-default" href="{% url 'rent:ads_ad_delete' ad.slug %}">
                    Supprimer
                </a>
            </div>
            <table class="table">
                {% for asr in ad.adsearchrelation_set.all %}
                {% if asr.valid %}
                <tr>
                    <td>
                        <a href="{% url 'rent:ads_search_detail' asr.search.slug %}">
                            {{ asr.search }}
                        </a>
                    </td>
                    <td>

                        {% if asr.search_contacted %}
                        Vous avez déjà contacté ce locataire
                        {% endif %}
                        {% if asr.ad_contacted %}
                        Vous avez été contacté par ce locataire
                        {% endif %}
                        <a href="{% url 'rent:ads_search_detail' asr.search.slug %}#contact">
                            Contactez ce locataire
                        </a>

                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>
        {% endfor %}
        {% endif %}
        <div>
            <a class="btn btn-default btn-primary" href="{% url 'rent:ads_ad_add' %}">
                Ajouter une annonce de bien à louer
            </a>
        </div>

    </div>
    <div role="tabpanel" class="tab-pane" id="sale_search">
        <br>
        {% if sale_searches %}

        {% for search in sale_searches %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="{% url 'sale:ads_search_detail' search.slug %}">
                    {{ search }}
                </a>
            </div>
            <div class="panel-body">
                <a class="btn btn-default" href="{% url 'sale:ads_search_update' search.slug %}">
                    Modifier
                </a>
                <a class="btn btn-default" href="{% url 'sale:ads_search_delete' search.slug %}">
                    Supprimer
                </a>
            </div>
            <table class="table">
                {% for asr in search.adsearchrelation_set.all %}
                {% if asr.valid %}
                <tr>
                    <td>
                        <a href="{% url 'sale:ads_ad_detail' asr.ad.slug %}">
                            {{ asr.ad }}
                        </a>
                    </td>
                    <td>
                        {% if asr.ad_contacted %}
                        Vous avez déjà contacté le vendeur
                        {% endif %}
                        {% if asr.search_contacted %}
                        Vous avez été contacté par le vendeur
                        {% endif %}
                        <a href="{% url 'sale:ads_ad_detail' asr.ad.slug %}#contact">
                            Contactez le vendeur
                        </a>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>
        {% endfor %}
        {% endif %}
        <div>
            <a class="btn btn-default btn-primary" href="{% url 'sale:ads_search_add' %}">
                Ajouter une annonce de recherche d'achat
            </a>
        </div>
    </div>
    <div role="tabpanel" class="tab-pane" id="rent_search">
        <br>
        {% if rentals_searches %}

        {% for search in rentals_searches %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <a href="{% url 'rent:ads_search_detail' search.slug %}">
                    {{ search }}
                </a>
            </div>
            <div class="panel-body">
                <a class="btn btn-default" href="{% url 'rent:ads_search_update' search.slug %}">
                    Modifier
                </a>
                <a class="btn btn-default" href="{% url 'rent:ads_search_delete' search.slug %}">
                    Supprimer
                </a>
            </div>
            <table class="table">
                {% for asr in search.adsearchrelation_set.all %}
                {% if asr.valid %}
                <tr>
                    <td>
                        <a href="{% url 'rent:ads_ad_detail' asr.ad.slug %}">{{ asr.ad }}</a>
                    </td>
                    <td>
                        {% if asr.ad_contacted %}
                        Vous avez déjà contacté le vendeur
                        {% else %}
                        {% if asr.search_contacted %}
                        Vous avez été contacté par le vendeur
                        {% else %}
                        <a href="{% url 'rent:ads_ad_detail' asr.ad.slug %}#contact">
                            Contactez le vendeur
                        </a>
                        {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </table>
        </div>
        {% endfor %}
        {% endif %}
        <div>
            <a class="btn btn-default btn-primary" href="{% url 'rent:ads_search_add' %}">
                Ajouter une annonce de recherche de location
            </a>
        </div>
    </div>

</div>
</div>

</div>

{% else %}

{% if sales %}

<h3>A vendre</h3>
<ul>
    {% for ad in sales %}
    <li><a href="{% url 'sale:ads_ad_detail' ad.slug %}">{{ ad }}</a></li>
    {% endfor %}
</ul>

{% endif %}

{% if sale_searches %}

<h3>Recherches achat</h3>
<ul>
    {% for search in sale_searches %}
    <li><a href="{% url 'sale:ads_search_detail' search.slug %}">{{ search }}</a></li>
    {% endfor %}
</ul>
{% endif %}

{% if rentals %}

<h3>A louer</h3>
<ul>
    {% for ad in rentals %}
    <li><a href="{% url 'rent:ads_ad_detail' ad.slug %}">{{ ad }}</a></li>
    {% endfor %}
</ul>

{% endif %}

{% if rent_searches %}

<h3>Recherches location</h3>
<ul>
    {% for search in rent_searches %}
    <li><a href="{% url 'rent:ads_search_detail' search.slug %}">{{ search }}</a></li>
    {% endfor %}
</ul>
{% endif %}


{% endif %}

{% endblock %}
